//* This file is part of the MOOSE framework
//* https://www.mooseframework.org
//*
//* All rights reserved, see COPYRIGHT for full restrictions
//* https://github.com/idaholab/moose/blob/master/COPYRIGHT
//*
//* Licensed under LGPL 2.1, please see LICENSE for details
//* https://www.gnu.org/licenses/lgpl-2.1.html

#include "ReporterContext.h"

ReporterContextBase::ReporterContextBase(const libMesh::ParallelObject & other)
  : libMesh::ParallelObject(other)
{
}

void
ReporterContextBase::init(const ReporterMode & mode)
{
  if (mode != REPORTER_MODE_UNSET)
    _producer_enum.assign(mode);
}

const ReporterProducerEnum &
ReporterContextBase::getProducerModeEnum() const
{
  return _producer_enum;
}

void
ReporterContextBase::requiresConsumerModes(const ReporterStateBase & state,
                                           const std::set<ReporterMode> & modes)
{
  for (const auto & mode_object_pair : state.getConsumers())
  {
    const ReporterMode consumer_mode = mode_object_pair.first;
    const MooseObject * moose_object = mode_object_pair.second;

    if (!modes.count(consumer_mode))
    {
      std::stringstream oss;
      std::copy(modes.begin(), modes.end(), std::ostream_iterator<ReporterMode>(oss, " "));

      mooseError("The Reporter value '",
                 name(),
                 "' is being produced in ",
                 _producer_enum,
                 " mode, but ",
                 moose_object->type(),
                 " '",
                 moose_object->name(),
                 "' is requesting to consume it in ",
                 consumer_mode,
                 " mode, which is not supported.\n\nThe mode must be { ",
                 oss.str(),
                 " }.\n\n",
                 state.getInfo(this));
    }
  }
}
